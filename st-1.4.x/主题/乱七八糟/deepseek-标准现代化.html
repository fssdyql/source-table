<!DOCTYPE html>
<html lang="zh-CN" class="light-mode">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{TITLE}} - 插件列表</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== CSS变量系统 ===== */
        :root {
            /* 色彩系统 */
            --color-primary: #6366f1;
            --color-primary-dark: #4f46e5;
            --color-secondary: #64748b;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-info: #3b82f6;
            
            /* 亮色主题 */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-card: #ffffff;
            --bg-hover: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --shadow-color-strong: rgba(0, 0, 0, 0.1);
            
            /* 间距系统 */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* 圆角系统 */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-full: 9999px;
            
            /* 字体系统 */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            
            /* 过渡效果 */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* 布局 */
            --header-height: 64px;
            --sidebar-width: 280px;
            --max-width: 1280px;
        }

        /* 暗色主题变量 */
        .dark-mode {
            --color-primary: #818cf8;
            --color-primary-dark: #6366f1;
            --color-secondary: #94a3b8;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --shadow-color-strong: rgba(0, 0, 0, 0.3);
        }

        /* ===== 重置与基础样式 ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            line-height: 1.5;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            transition: background-color var(--transition-normal),
                        color var(--transition-normal);
            min-height: 100vh;
        }

        a {
            color: var(--color-primary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        a:hover {
            color: var(--color-primary-dark);
        }

        button {
            font-family: var(--font-family);
            cursor: pointer;
            border: none;
            background: none;
        }

        ul, ol {
            list-style: none;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        /* ===== 工具类 ===== */
        .container {
            width: 100%;
            max-width: var(--max-width);
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-xs {
            gap: var(--spacing-xs);
        }

        .gap-sm {
            gap: var(--spacing-sm);
        }

        .gap-md {
            gap: var(--spacing-md);
        }

        .gap-lg {
            gap: var(--spacing-lg);
        }

        .gap-xl {
            gap: var(--spacing-xl);
        }

        .hidden {
            display: none !important;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* ===== 组件样式 ===== */
        /* 按钮 */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-md);
            font-weight: 500;
            font-size: var(--font-size-sm);
            transition: all var(--transition-fast);
            gap: var(--spacing-sm);
            white-space: nowrap;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
            border: 1px solid var(--color-primary);
        }

        .btn-primary:hover {
            background-color: var(--color-primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color-strong);
        }

        .btn-secondary {
            background-color: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--bg-hover);
            border-color: var(--color-primary);
        }

        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-md);
            font-size: var(--font-size-xs);
        }

        .btn-icon {
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
        }

        /* 徽章 */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.125rem 0.5rem;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 500;
            line-height: 1;
        }

        .badge-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .badge-secondary {
            background-color: var(--bg-hover);
            color: var(--text-secondary);
        }

        .badge-success {
            background-color: var(--color-success);
            color: white;
        }

        .badge-warning {
            background-color: var(--color-warning);
            color: white;
        }

        .badge-danger {
            background-color: var(--color-danger);
            color: white;
        }

        /* 卡片 */
        .card {
            background-color: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: all var(--transition-normal);
        }

        .card:hover {
            border-color: var(--color-primary);
            box-shadow: 0 8px 24px var(--shadow-color);
            transform: translateY(-4px);
        }

        .card-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
        }

        .card-body {
            padding: var(--spacing-lg);
        }

        .card-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
        }

        /* 输入框 */
        .input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            background-color: var(--bg-card);
            color: var(--text-primary);
            font-size: var(--font-size-base);
            transition: border-color var(--transition-fast),
                        box-shadow var(--transition-fast);
        }

        .input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .input-search {
            padding-left: 2.75rem;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cpath d='m21 21-4.35-4.35'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 0.75rem center;
            background-size: 1rem;
        }

        .input-search:focus {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236366f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cpath d='m21 21-4.35-4.35'%3E%3C/path%3E%3C/svg%3E");
        }

        /* 标签页 */
        .tabs {
            display: flex;
            overflow-x: auto;
            border-bottom: 1px solid var(--border-color);
            gap: var(--spacing-sm);
            padding: 0 var(--spacing-sm);
        }

        .tab {
            padding: var(--spacing-sm) var(--spacing-md);
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        /* 模态框 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-normal),
                        visibility var(--transition-normal);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--bg-card);
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform var(--transition-normal);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        /* ===== 布局 ===== */
        /* 头部 */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            height: var(--header-height);
            backdrop-filter: blur(10px);
            background-color: rgba(var(--bg-primary-rgb), 0.8);
        }

        .header-content {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 700;
            font-size: var(--font-size-xl);
            color: var(--text-primary);
        }

        .logo-icon {
            color: var(--color-primary);
        }

        /* 主内容区 */
        .main-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-xl);
            padding: var(--spacing-xl) 0;
        }

        @media (min-width: 1024px) {
            .main-container {
                grid-template-columns: var(--sidebar-width) 1fr;
            }
        }

        /* 侧边栏 */
        .sidebar {
            display: none;
        }

        @media (min-width: 1024px) {
            .sidebar {
                display: block;
                position: sticky;
                top: calc(var(--header-height) + var(--spacing-xl));
                align-self: start;
            }
        }

        /* 内容区域 */
        .content {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xl);
        }

        /* 工具栏 */
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md);
            background-color: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
        }

        .toolbar-left,
        .toolbar-right {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            align-items: center;
        }

        /* 插件网格 */
        .plugins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--spacing-lg);
        }

        @media (max-width: 640px) {
            .plugins-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 插件卡片 */
        .plugin-card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .plugin-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }

        .plugin-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .plugin-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .plugin-description {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
            flex-grow: 1;
        }

        .plugin-actions {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-top: auto;
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: var(--spacing-2xl) var(--spacing-lg);
        }

        .empty-state-icon {
            font-size: 3rem;
            color: var(--text-muted);
            margin-bottom: var(--spacing-lg);
        }

        .empty-state-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .empty-state-description {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
        }

        /* 页脚 */
        .footer {
            margin-top: var(--spacing-2xl);
            padding: var(--spacing-xl) 0;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-md);
            text-align: center;
        }

        /* 主题切换器 */
        .theme-switcher {
            position: relative;
            width: 3rem;
            height: 1.5rem;
        }

        .theme-switcher-checkbox {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-switcher-label {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-hover);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }

        .theme-switcher-label:before {
            content: '';
            position: absolute;
            top: 0.125rem;
            left: 0.125rem;
            width: 1.25rem;
            height: 1.25rem;
            background-color: white;
            border-radius: 50%;
            transition: transform var(--transition-fast);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .theme-switcher-checkbox:checked + .theme-switcher-label {
            background-color: var(--color-primary);
        }

        .theme-switcher-checkbox:checked + .theme-switcher-label:before {
            transform: translateX(1.5rem);
        }

        /* 动画 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn var(--transition-normal) ease-out forwards;
        }

        /* 加载状态 */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-2xl);
        }

        .loading-spinner {
            width: 2.5rem;
            height: 2.5rem;
            border: 3px solid var(--border-color);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 统计卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .stat-card {
            text-align: center;
            padding: var(--spacing-lg);
        }

        .stat-value {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--color-primary);
            line-height: 1;
            margin-bottom: var(--spacing-sm);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body>
    <!-- 头部 -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-plug logo-icon"></i>
                    <span>{{TITLE}}</span>
                </div>
                <div class="flex items-center gap-md">
                    <div class="theme-switcher">
                        <input type="checkbox" id="theme-switch" class="theme-switcher-checkbox">
                        <label for="theme-switch" class="theme-switcher-label">
                            <span class="sr-only">切换主题</span>
                        </label>
                    </div>
                    <button class="btn btn-icon" id="filter-btn" title="筛选">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container">
        <div class="main-container">
            <!-- 侧边栏 -->
            <aside class="sidebar">
                <div class="card">
                    <div class="card-header">
                        <h3>筛选器</h3>
                    </div>
                    <div class="card-body">
                        <div class="flex flex-col gap-lg">
                            <div>
                                <label for="quality-filter" class="block mb-sm">音质</label>
                                <select id="quality-filter" class="input">
                                    <option value="">全部音质</option>
                                </select>
                            </div>
                            <div>
                                <label for="size-filter" class="block mb-sm">文件大小</label>
                                <select id="size-filter" class="input">
                                    <option value="">全部大小</option>
                                    <option value="small">小于 100KB</option>
                                    <option value="medium">100KB - 1MB</option>
                                    <option value="large">大于 1MB</option>
                                </select>
                            </div>
                            <div>
                                <label class="flex items-center gap-sm">
                                    <input type="checkbox" id="has-links-filter">
                                    <span>仅显示有链接</span>
                                </label>
                            </div>
                            <div>
                                <label class="flex items-center gap-sm">
                                    <input type="checkbox" id="has-key-config-filter">
                                    <span>仅显示可配置Key</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-secondary w-full" id="reset-filters">
                            <i class="fas fa-redo"></i>
                            重置筛选
                        </button>
                    </div>
                </div>
                
                <div class="card mt-lg">
                    <div class="card-header">
                        <h3>统计信息</h3>
                    </div>
                    <div class="card-body">
                        <div id="stats-container">
                            <!-- 统计信息将动态生成 -->
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 内容区域 -->
            <div class="content">
                <!-- 标签页 -->
                <div class="card">
                    <div class="tabs" id="tabs-container"></div>
                </div>

                <!-- 工具栏 -->
                <div class="toolbar">
                    <div class="toolbar-left">
                        <div class="relative" style="width: 300px;">
                            <input type="search" 
                                   id="search-input" 
                                   class="input input-search" 
                                   placeholder="搜索插件名称、描述、音质...">
                            <div class="absolute right-2 top-1/2 transform -translate-y-1/2">
                                <button class="btn btn-icon btn-sm" id="clear-search" title="清除搜索">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="text-sm text-muted" id="search-info">
                            <!-- 搜索信息将动态生成 -->
                        </div>
                    </div>
                    <div class="toolbar-right">
                        <button class="btn btn-secondary" id="export-btn">
                            <i class="fas fa-download"></i>
                            导出数据
                        </button>
                    </div>
                </div>

                <!-- 插件列表 -->
                <div id="plugins-container">
                    <!-- 插件卡片将动态生成 -->
                </div>

                <!-- 空状态 -->
                <div id="empty-state" class="card empty-state hidden">
                    <div class="empty-state-icon">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <div class="empty-state-title">未找到插件</div>
                    <div class="empty-state-description">
                        当前筛选条件下未找到匹配的插件，请尝试调整搜索条件或筛选器。
                    </div>
                    <button class="btn btn-primary mx-auto" id="reset-all">
                        <i class="fas fa-redo"></i>
                        重置所有筛选
                    </button>
                </div>

                <!-- 加载状态 -->
                <div id="loading-state" class="card loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div>
                    由插件列表管理器生成 | 导出时间：<span id="export-date">{{DATE}}</span>
                </div>
                <div>
                    共 <span id="total-count">0</span> 个插件 | 
                    <span id="total-size">0 B</span> 总大小
                </div>
            </div>
        </div>
    </footer>

    <!-- Key配置模态框 -->
    <div class="modal" id="key-modal">
        <div class="modal-content">
            <div class="card">
                <div class="card-header flex justify-between items-center">
                    <h3 id="key-modal-title">配置 Key</h3>
                    <button class="btn btn-icon" id="close-key-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="card-body">
                    <div id="key-config-content">
                        <!-- Key配置内容将动态生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 脚本 -->
    <script>
        // 应用状态
        const appState = {
            data: null,
            currentTab: 'LX',
            searchQuery: '',
            filters: {
                quality: '',
                size: '',
                hasLinks: false,
                hasKeyConfig: false
            },
            viewMode: 'grid',
            darkMode: window.matchMedia('(prefers-color-scheme: dark)').matches
        };

        // 初始化应用
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // 解析数据
                appState.data = parseData({{DATA}});
                
                // 初始化UI
                initTheme();
                initTabs();
                initFilters();
                initSearch();
                initStats();
                renderPlugins();
                
                // 隐藏加载状态
                document.getElementById('loading-state').classList.add('hidden');
            } catch (error) {
                console.error('初始化失败:', error);
                showError('数据加载失败，请检查数据格式');
            }
        });

        // ===== 数据解析 =====
        function parseData(rawData) {
            try {
                let data;
                if (typeof rawData === 'string') {
                    data = JSON.parse(rawData);
                } else {
                    data = rawData;
                }
                
                // 数据验证和增强
                const validatedData = {
                    config: data.config || { showMF: false, showLY: false },
                    customTabs: data.customTabs || [],
                    items: (data.items || []).map(item => ({
                        id: item.id || Date.now() + Math.random(),
                        tab: item.tab || 'LX',
                        name: item.name || '未命名插件.js',
                        ver: item.ver || '1.0.0',
                        quality: item.quality || '未知',
                        note: item.note || '无描述',
                        file: item.file || null,
                        links: item.links || [],
                        dlLink: item.dlLink || '',
                        keyConfig: item.keyConfig || null
                    }))
                };
                
                return validatedData;
            } catch (error) {
                console.error('数据解析失败:', error);
                return {
                    config: { showMF: false, showLY: false },
                    customTabs: [],
                    items: []
                };
            }
        }

        // ===== 主题管理 =====
        function initTheme() {
            const themeSwitch = document.getElementById('theme-switch');
            const savedTheme = localStorage.getItem('theme');
            
            if (savedTheme === 'dark' || (!savedTheme && appState.darkMode)) {
                document.documentElement.classList.add('dark-mode');
                themeSwitch.checked = true;
            }
            
            themeSwitch.addEventListener('change', () => {
                if (themeSwitch.checked) {
                    document.documentElement.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light');
                }
            });
        }

        // ===== 标签页管理 =====
        function initTabs() {
            const tabsContainer = document.getElementById('tabs-container');
            const { config, customTabs } = appState.data;
            
            // 基础标签页
            const baseTabs = ['LX'];
            if (config.showMF) baseTabs.push('Music Free');
            if (config.showLY) baseTabs.push('澜音');
            
            // 自定义标签页
            const allTabs = [...baseTabs, ...customTabs];
            
            // 生成标签页
            tabsContainer.innerHTML = allTabs.map(tab => `
                <button class="tab ${tab === appState.currentTab ? 'active' : ''}" 
                        data-tab="${tab}">
                    ${tab}
                    <span class="badge badge-secondary ml-1 tab-count" data-tab="${tab}">
                        0
                    </span>
                </button>
            `).join('');
            
            // 添加事件监听
            tabsContainer.addEventListener('click', (e) => {
                const tabBtn = e.target.closest('.tab');
                if (tabBtn) {
                    switchTab(tabBtn.dataset.tab);
                }
            });
            
            // 更新计数
            updateTabCounts();
        }

        function switchTab(tabName) {
            appState.currentTab = tabName;
            
            // 更新活跃标签页
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            // 重新渲染插件
            renderPlugins();
        }

        function updateTabCounts() {
            const { items } = appState.data;
            const counts = {};
            
            items.forEach(item => {
                const tab = item.tab || 'LX';
                counts[tab] = (counts[tab] || 0) + 1;
            });
            
            // 更新计数显示
            document.querySelectorAll('.tab-count').forEach(span => {
                const tab = span.dataset.tab;
                span.textContent = counts[tab] || 0;
            });
        }

        // ===== 筛选器管理 =====
        function initFilters() {
            const qualityFilter = document.getElementById('quality-filter');
            const sizeFilter = document.getElementById('size-filter');
            const hasLinksFilter = document.getElementById('has-links-filter');
            const hasKeyConfigFilter = document.getElementById('has-key-config-filter');
            const resetFiltersBtn = document.getElementById('reset-filters');
            const filterBtn = document.getElementById('filter-btn');
            
            // 填充音质筛选器选项
            const qualities = [...new Set(appState.data.items.map(item => item.quality).filter(Boolean))];
            qualities.sort();
            qualities.forEach(quality => {
                const option = document.createElement('option');
                option.value = quality;
                option.textContent = quality;
                qualityFilter.appendChild(option);
            });
            
            // 筛选器事件监听
            qualityFilter.addEventListener('change', (e) => {
                appState.filters.quality = e.target.value;
                renderPlugins();
            });
            
            sizeFilter.addEventListener('change', (e) => {
                appState.filters.size = e.target.value;
                renderPlugins();
            });
            
            hasLinksFilter.addEventListener('change', (e) => {
                appState.filters.hasLinks = e.target.checked;
                renderPlugins();
            });
            
            hasKeyConfigFilter.addEventListener('change', (e) => {
                appState.filters.hasKeyConfig = e.target.checked;
                renderPlugins();
            });
            
            resetFiltersBtn.addEventListener('click', () => {
                qualityFilter.value = '';
                sizeFilter.value = '';
                hasLinksFilter.checked = false;
                hasKeyConfigFilter.checked = false;
                
                appState.filters = {
                    quality: '',
                    size: '',
                    hasLinks: false,
                    hasKeyConfig: false
                };
                
                renderPlugins();
            });
            
            // 移动端筛选按钮
            filterBtn.addEventListener('click', () => {
                const sidebar = document.querySelector('.sidebar');
                sidebar.classList.toggle('hidden');
            });
        }

        // ===== 搜索功能 =====
        function initSearch() {
            const searchInput = document.getElementById('search-input');
            const clearSearchBtn = document.getElementById('clear-search');
            const resetAllBtn = document.getElementById('reset-all');
            
            // 防抖搜索
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    appState.searchQuery = e.target.value.trim();
                    renderPlugins();
                }, 300);
            });
            
            clearSearchBtn.addEventListener('click', () => {
                searchInput.value = '';
                appState.searchQuery = '';
                renderPlugins();
            });
            
            resetAllBtn.addEventListener('click', () => {
                searchInput.value = '';
                appState.searchQuery = '';
                
                // 重置筛选器
                document.getElementById('quality-filter').value = '';
                document.getElementById('size-filter').value = '';
                document.getElementById('has-links-filter').checked = false;
                document.getElementById('has-key-config-filter').checked = false;
                
                appState.filters = {
                    quality: '',
                    size: '',
                    hasLinks: false,
                    hasKeyConfig: false
                };
                
                renderPlugins();
            });
            
            // 导出按钮
            document.getElementById('export-btn').addEventListener('click', exportData);
        }

        // ===== 统计信息 =====
        function initStats() {
            const statsContainer = document.getElementById('stats-container');
            const totalCountEl = document.getElementById('total-count');
            const totalSizeEl = document.getElementById('total-size');
            
            const { items } = appState.data;
            
            // 计算统计信息
            const totalSize = items.reduce((sum, item) => sum + (item.file?.size || 0), 0);
            const qualityStats = {};
            const tabStats = {};
            
            items.forEach(item => {
                // 音质统计
                const quality = item.quality || '未知';
                qualityStats[quality] = (qualityStats[quality] || 0) + 1;
                
                // 标签页统计
                const tab = item.tab || 'LX';
                tabStats[tab] = (tabStats[tab] || 0) + 1;
            });
            
            // 更新总统计
            totalCountEl.textContent = items.length;
            totalSizeEl.textContent = formatFileSize(totalSize);
            
            // 渲染统计卡片
            const topQualities = Object.entries(qualityStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);
            
            statsContainer.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${items.length}</div>
                        <div class="stat-label">插件总数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formatFileSize(totalSize)}</div>
                        <div class="stat-label">总大小</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${Object.keys(tabStats).length}</div>
                        <div class="stat-label">标签页</div>
                    </div>
                </div>
                <div class="mt-lg">
                    <h4 class="mb-sm">音质分布</h4>
                    <div class="flex flex-col gap-sm">
                        ${topQualities.map(([quality, count]) => `
                            <div class="flex justify-between items-center">
                                <span>${quality}</span>
                                <span class="badge badge-secondary">${count}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ===== 插件渲染 =====
        function renderPlugins() {
            const pluginsContainer = document.getElementById('plugins-container');
            const emptyState = document.getElementById('empty-state');
            const searchInfo = document.getElementById('search-info');
            
            // 获取当前标签页的插件
            let plugins = appState.data.items.filter(item => 
                (item.tab || 'LX') === appState.currentTab
            );
            
            // 应用搜索
            if (appState.searchQuery) {
                plugins = filterBySearch(plugins, appState.searchQuery);
            }
            
            // 应用筛选器
            plugins = applyFilters(plugins);
            
            // 更新搜索信息
            const totalPlugins = appState.data.items.filter(item => 
                (item.tab || 'LX') === appState.currentTab
            ).length;
            
            searchInfo.innerHTML = `
                显示 ${plugins.length} 个插件 (共 ${totalPlugins} 个)
                ${appState.searchQuery ? ` | 搜索: "${appState.searchQuery}"` : ''}
            `;
            
            // 渲染插件或显示空状态
            if (plugins.length === 0) {
                pluginsContainer.innerHTML = '';
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                pluginsContainer.innerHTML = plugins.map(plugin => createPluginCard(plugin)).join('');
                
                // 为卡片添加动画
                document.querySelectorAll('.plugin-card').forEach((card, index) => {
                    card.style.animationDelay = `${index * 50}ms`;
                    card.classList.add('fade-in');
                });
                
                // 添加事件监听
                attachCardEvents();
            }
        }

        function filterBySearch(plugins, query) {
            const keywords = query.toLowerCase().split(/\s+/).filter(k => k.length > 0);
            
            return plugins.filter(plugin => {
                const searchText = [
                    plugin.name,
                    plugin.note,
                    plugin.ver,
                    plugin.quality,
                    ...(plugin.links || []).map(link => link.text)
                ].join(' ').toLowerCase();
                
                return keywords.every(keyword => searchText.includes(keyword));
            });
        }

        function applyFilters(plugins) {
            const { quality, size, hasLinks, hasKeyConfig } = appState.filters;
            
            return plugins.filter(plugin => {
                // 音质筛选
                if (quality && plugin.quality !== quality) return false;
                
                // 大小筛选
                if (size && plugin.file) {
                    const fileSize = plugin.file.size;
                    if (size === 'small' && fileSize >= 100 * 1024) return false;
                    if (size === 'medium' && (fileSize < 100 * 1024 || fileSize > 1024 * 1024)) return false;
                    if (size === 'large' && fileSize <= 1024 * 1024) return false;
                }
                
                // 链接筛选
                if (hasLinks && (!plugin.links || plugin.links.length === 0)) return false;
                
                // Key配置筛选
                if (hasKeyConfig && !plugin.keyConfig) return false;
                
                return true;
            });
        }

        function createPluginCard(plugin) {
            const hasFile = !!plugin.file;
            const hasKeyConfig = !!plugin.keyConfig;
            const hasLinks = plugin.links && plugin.links.length > 0;
            
            return `
                <div class="card plugin-card" data-id="${plugin.id}">
                    <div class="card-body">
                        <div class="plugin-header">
                            <div>
                                <h3 class="plugin-title">${escapeHtml(plugin.name)}</h3>
                                <div class="flex items-center gap-sm">
                                    ${plugin.ver ? `<span class="badge badge-secondary">v${plugin.ver}</span>` : ''}
                                    ${plugin.quality ? `<span class="badge badge-primary">${plugin.quality}</span>` : ''}
                                    ${hasFile ? `<span class="badge badge-success">${formatFileSize(plugin.file.size)}</span>` : ''}
                                </div>
                            </div>
                            <div class="flex gap-xs">
                                ${plugin.tab ? `<span class="badge badge-secondary">${plugin.tab}</span>` : ''}
                            </div>
                        </div>
                        
                        <div class="plugin-meta">
                            ${plugin.note ? `<div class="plugin-description">${escapeHtml(plugin.note)}</div>` : ''}
                        </div>
                        
                        ${hasLinks ? `
                            <div class="mb-lg">
                                <h4 class="mb-sm text-sm font-medium">相关链接</h4>
                                <div class="flex flex-wrap gap-sm">
                                    ${plugin.links.map(link => `
                                        <a href="${escapeHtml(link.url)}" 
                                           target="_blank" 
                                           rel="noopener noreferrer"
                                           class="btn btn-sm btn-secondary">
                                            <i class="fas fa-external-link-alt"></i>
                                            ${escapeHtml(link.text)}
                                        </a>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="plugin-actions">
                            ${hasFile ? `
                                <button class="btn btn-primary download-btn" data-id="${plugin.id}">
                                    <i class="fas fa-download"></i>
                                    下载
                                </button>
                            ` : ''}
                            
                            ${plugin.dlLink ? `
                                <a href="${escapeHtml(plugin.dlLink)}" 
                                   target="_blank"
                                   class="btn btn-secondary">
                                    <i class="fas fa-external-link-alt"></i>
                                    直链
                                </a>
                            ` : ''}
                            
                            ${hasKeyConfig ? `
                                <button class="btn btn-secondary key-config-btn" data-id="${plugin.id}">
                                    <i class="fas fa-key"></i>
                                    配置 Key
                                </button>
                            ` : ''}
                            
                            ${hasFile ? `
                                <button class="btn btn-icon preview-btn" data-id="${plugin.id}" title="预览代码">
                                    <i class="fas fa-eye"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function attachCardEvents() {
            // 下载按钮
            document.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const pluginId = e.target.closest('[data-id]').dataset.id;
                    downloadPlugin(pluginId);
                });
            });
            
            // Key配置按钮
            document.querySelectorAll('.key-config-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const pluginId = e.target.closest('[data-id]').dataset.id;
                    showKeyConfig(pluginId);
                });
            });
            
            // 预览按钮
            document.querySelectorAll('.preview-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const pluginId = e.target.closest('[data-id]').dataset.id;
                    previewPlugin(pluginId);
                });
            });
        }

        // ===== 插件操作 =====
        function downloadPlugin(pluginId) {
            const plugin = appState.data.items.find(p => p.id == pluginId);
            if (!plugin || !plugin.file) {
                showError('文件不存在或无法下载');
                return;
            }
            
            try {
                const a = document.createElement('a');
                a.href = plugin.file.content;
                a.download = plugin.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // 显示成功反馈
                showNotification(`已开始下载: ${plugin.name}`);
            } catch (error) {
                console.error('下载失败:', error);
                showError(`下载失败: ${error.message}`);
            }
        }

        function showKeyConfig(pluginId) {
            const plugin = appState.data.items.find(p => p.id == pluginId);
            if (!plugin || !plugin.keyConfig) return;
            
            const modal = document.getElementById('key-modal');
            const title = document.getElementById('key-modal-title');
            const content = document.getElementById('key-config-content');
            const closeBtn = document.getElementById('close-key-modal');
            
            title.textContent = `配置 Key - ${plugin.name}`;
            
            content.innerHTML = `
                <div class="flex flex-col gap-lg">
                    <div>
                        <h4 class="mb-sm">在线导入 Key</h4>
                        ${plugin.keyConfig.enableUrl ? `
                            <div class="flex gap-sm">
                                <input type="text" 
                                       id="online-key-input" 
                                       class="input flex-grow" 
                                       placeholder="请输入 Key">
                                <button class="btn btn-primary" id="import-online-key">
                                    导入
                                </button>
                            </div>
                            <div class="mt-sm text-sm text-muted">
                                将使用: ${escapeHtml(plugin.keyConfig.url)}?key=[你的Key]
                            </div>
                        ` : `
                            <div class="text-muted">此插件不支持在线导入 Key</div>
                        `}
                    </div>
                    
                    <div>
                        <h4 class="mb-sm">本地 Key 替换</h4>
                        ${plugin.keyConfig.enableVar ? `
                            <div class="flex gap-sm">
                                <input type="text" 
                                       id="local-key-input" 
                                       class="input flex-grow" 
                                       placeholder="请输入 Key (将替换变量 ${escapeHtml(plugin.keyConfig.var || 'API_KEY')})">
                                <button class="btn btn-primary" id="generate-with-key">
                                    生成文件
                                </button>
                            </div>
                            <div class="mt-sm text-sm text-muted">
                                将在代码中替换变量: ${escapeHtml(plugin.keyConfig.var || 'API_KEY')}
                            </div>
                        ` : `
                            <div class="text-muted">此插件不支持本地 Key 替换</div>
                        `}
                    </div>
                </div>
            `;
            
            // 显示模态框
            modal.classList.add('active');
            
            // 事件监听
            closeBtn.addEventListener('click', () => {
                modal.classList.remove('active');
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
            
            // 在线导入
            if (plugin.keyConfig.enableUrl) {
                document.getElementById('import-online-key').addEventListener('click', () => {
                    const key = document.getElementById('online-key-input').value.trim();
                    if (!key) {
                        showError('请输入 Key');
                        return;
                    }
                    
                    const url = `${plugin.keyConfig.url}${encodeURIComponent(key)}`;
                    window.open(url, '_blank');
                    modal.classList.remove('active');
                    showNotification('正在打开 Key 导入页面...');
                });
            }
            
            // 本地生成
            if (plugin.keyConfig.enableVar) {
                document.getElementById('generate-with-key').addEventListener('click', () => {
                    const key = document.getElementById('local-key-input').value.trim();
                    if (!key) {
                        showError('请输入 Key');
                        return;
                    }
                    
                    generateFileWithKey(plugin, key);
                    modal.classList.remove('active');
                });
            }
        }

        function generateFileWithKey(plugin, key) {
            try {
                if (!plugin.file) {
                    throw new Error('文件数据不存在');
                }
                
                // 解码 Base64
                const base64Data = plugin.file.content.split(',')[1];
                const originalContent = atob(base64Data);
                
                // 替换变量
                const varName = plugin.keyConfig.var || 'API_KEY';
                const regex = new RegExp(`(const|let|var)\\s+${varName}\\s*=\\s*['"][^'"]*['"]`, 'g');
                
                if (!regex.test(originalContent)) {
                    throw new Error(`未找到变量 ${varName}`);
                }
                
                const newContent = originalContent.replace(
                    regex,
                    `$1 ${varName} = "${key.replace(/"/g, '\\"')}"`
                );
                
                // 创建新文件
                const blob = new Blob([newContent], { type: 'text/javascript' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = plugin.name.replace('.js', `-with-key.js`);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // 清理
                setTimeout(() => URL.revokeObjectURL(url), 100);
                
                showNotification('文件已生成并开始下载');
            } catch (error) {
                console.error('生成文件失败:', error);
                showError(`生成失败: ${error.message}`);
            }
        }

        function previewPlugin(pluginId) {
            const plugin = appState.data.items.find(p => p.id == pluginId);
            if (!plugin || !plugin.file) return;
            
            try {
                // 解码 Base64
                const base64Data = plugin.file.content.split(',')[1];
                const content = atob(base64Data);
                
                // 创建预览模态框
                const previewModal = document.createElement('div');
                previewModal.className = 'modal active';
                previewModal.innerHTML = `
                    <div class="modal-content" style="max-width: 800px;">
                        <div class="card">
                            <div class="card-header flex justify-between items-center">
                                <h3>代码预览 - ${escapeHtml(plugin.name)}</h3>
                                <button class="btn btn-icon close-preview">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="card-body">
                                <pre style="max-height: 60vh; overflow: auto; background: var(--bg-secondary); padding: var(--spacing-md); border-radius: var(--radius-md); font-family: 'Monaco', 'Menlo', monospace; font-size: var(--font-size-sm);">${escapeHtml(content)}</pre>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-primary copy-code-btn">
                                    <i class="fas fa-copy"></i>
                                    复制代码
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(previewModal);
                
                // 关闭按钮
                previewModal.querySelector('.close-preview').addEventListener('click', () => {
                    document.body.removeChild(previewModal);
                });
                
                previewModal.addEventListener('click', (e) => {
                    if (e.target === previewModal) {
                        document.body.removeChild(previewModal);
                    }
                });
                
                // 复制代码按钮
                previewModal.querySelector('.copy-code-btn').addEventListener('click', () => {
                    navigator.clipboard.writeText(content).then(() => {
                        showNotification('代码已复制到剪贴板');
                    }).catch(err => {
                        showError('复制失败: ' + err.message);
                    });
                });
            } catch (error) {
                console.error('预览失败:', error);
                showError('预览失败: ' + error.message);
            }
        }

        // ===== 工具函数 =====
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showNotification(message, type = 'success') {
            // 创建通知元素
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: var(--spacing-md) var(--spacing-lg);
                background-color: ${type === 'error' ? 'var(--color-danger)' : 'var(--color-success)'};
                color: white;
                border-radius: var(--radius-md);
                box-shadow: 0 4px 12px var(--shadow-color-strong);
                z-index: 1000;
                animation: fadeIn 0.3s ease-out;
                max-width: 300px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // 自动移除
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function showError(message) {
            showNotification(message, 'error');
        }

        function exportData() {
            try {
                const dataStr = JSON.stringify(appState.data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `plugin-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // 清理
                setTimeout(() => URL.revokeObjectURL(url), 100);
                
                showNotification('数据已导出为 JSON 文件');
            } catch (error) {
                console.error('导出失败:', error);
                showError('导出失败: ' + error.message);
            }
        }

        // 移动端适配
        window.addEventListener('resize', () => {
            const sidebar = document.querySelector('.sidebar');
            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>