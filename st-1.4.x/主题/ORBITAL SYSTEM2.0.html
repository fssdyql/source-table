<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>{{TITLE}}</title>
<style>
    /* --- æ ¸å¿ƒå˜é‡ --- */
    :root {
        --bg-deep: #0a0a0a;
        --accent: #eeb92e;       /* ç¥ç€é‡‘ */
        --accent-glow: rgba(238, 185, 46, 0.4);
        --danger: #ff4757;
        --glass: rgba(20, 20, 20, 0.90);
        --border: rgba(255, 255, 255, 0.15);
        --text: #f1f1f1;
    }

    body {
        margin: 0;
        background: var(--bg-deep);
        background-image: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
        height: 100vh;
        overflow: hidden;
        font-family: "Courier New", monospace;
        color: var(--text);
        user-select: none;
        -webkit-tap-highlight-color: transparent;
    }

    /* --- é¡¶éƒ¨ UI --- */
    #header { 
        position: absolute; top: 20px; left: 20px; 
        /* å…¼å®¹åˆ˜æµ·å± */
        top: max(20px, env(safe-area-inset-top)); 
        z-index: 10; pointer-events: none; 
    }
    h1 { margin: 0; font-size: 1.2rem; letter-spacing: 2px; color: var(--accent); }
    .subtitle { font-size: 0.7rem; opacity: 0.5; margin-top: 4px; }

    /* --- åº•éƒ¨å¯¼èˆª (ä¿®å¤ç‰ˆ) --- */
    #nav-dots { 
        position: absolute; 
        /* ä¿®å¤ï¼šå¢åŠ å…¼å®¹æ€§ Fallbackï¼Œé˜²æ­¢ max() å¤±æ•ˆå¯¼è‡´å¯¼èˆªæ¶ˆå¤± */
        bottom: 30px; 
        bottom: max(30px, env(safe-area-inset-bottom)); 
        width: 100%; text-align: center; z-index: 20; /* æé«˜å±‚çº§ */
        display: flex; justify-content: center; align-items: flex-end; gap: 15px;
        pointer-events: auto; /* ç¡®ä¿å¯ç‚¹å‡» */
    }
    
    .nav-item {
        display: flex; flex-direction: column; align-items: center;
        cursor: pointer; opacity: 0.5; transition: 0.3s;
        position: relative;
    }
    .nav-item::after { content: ''; position: absolute; inset: -10px; } /* å¢å¤§çƒ­åŒº */
    
    /* æ ‡ç­¾æ–‡å­— */
    .nav-text {
        font-size: 10px; margin-bottom: 4px; font-weight: bold;
        text-transform: uppercase; letter-spacing: 1px;
        transform: translateY(5px); opacity: 0; transition: 0.3s;
    }
    
    /* å¯¼èˆªç‚¹ */
    .nav-dot { 
        display: block; width: 6px; height: 6px; 
        background: #fff; border-radius: 50%; 
        box-shadow: 0 0 5px rgba(0,0,0,0.5);
        transition: 0.3s;
    }

    /* æ¿€æ´»çŠ¶æ€ */
    .nav-item.active { opacity: 1; transform: translateY(-2px); }
    .nav-item.active .nav-text { transform: translateY(0); opacity: 1; color: var(--accent); }
    .nav-item.active .nav-dot { 
        background: var(--accent); transform: scale(1.4); 
        box-shadow: 0 0 10px var(--accent-glow); 
    }

    /* --- å®‡å®™è§†å£ --- */
    #universe {
        position: relative; width: 100vw; height: 100vh;
        overflow: hidden;
        perspective: 1000px;
    }

    /* èƒŒæ™¯å¤§å­— */
    #category-label {
        position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        font-size: 14vw; font-weight: 900;
        color: rgba(255,255,255,0.02); pointer-events: none;
        white-space: nowrap; letter-spacing: -2px;
        transition: opacity 0.5s;
    }

    /* --- ç»å¯¹ä¸­å¿ƒå®šä½ç³»ç»Ÿ --- */
    #absolute-center {
        position: absolute; 
        top: 50%; left: 50%;
        width: 0; height: 0;
        transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s;
        z-index: 1;
    }
    
    body.detail-open #absolute-center {
        transform: scale(0.85);
        opacity: 0.3; filter: blur(2px);
    }

    /* è½¨é“åœ†ç¯ */
    .orbit-ring {
        position: absolute;
        top: 0; left: 0;
        border: 1px dashed rgba(238, 185, 46, 0.2);
        border-radius: 50%;
        transform: translate(-50%, -50%); 
        animation: rotate-orbit 120s linear infinite;
        will-change: transform;
        pointer-events: none;
        transition: width 0.5s ease-out, height 0.5s ease-out;
    }

    /* æ˜Ÿçƒ */
    .planet {
        position: absolute;
        top: 0; left: 0;
        width: 44px; height: 44px;
        margin-left: -22px; margin-top: -22px;
        display: flex; justify-content: center; align-items: center;
        cursor: pointer; z-index: 5;
        transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }
    
    .planet-core {
        width: 12px; height: 12px;
        background: var(--accent);
        border-radius: 50%;
        box-shadow: 0 0 15px var(--accent-glow);
        transition: 0.3s;
        position: relative;
    }
    .planet-core::before {
        content: ''; position: absolute; inset: -5px;
        border: 1px solid var(--accent); border-radius: 50%;
        opacity: 0.3; animation: pulse 2s infinite;
    }
    
    .planet:active .planet-core, .planet:hover .planet-core { 
        background: #fff; transform: scale(1.3); 
        box-shadow: 0 0 25px var(--accent); 
    }
    
    .planet-label {
        position: absolute; top: -28px;
        background: var(--accent); color: #000;
        padding: 2px 6px; border-radius: 3px;
        font-size: 10px; font-weight: bold;
        transform: scale(0); transition: 0.2s;
        pointer-events: none; white-space: nowrap;
        box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    }
    .planet:hover .planet-label { transform: scale(1); }

    /* --- è¯¦æƒ…é¢æ¿ --- */
    #backdrop {
        position: absolute; inset: 0; z-index: 40;
        background: rgba(0,0,0,0.4); backdrop-filter: blur(3px);
        opacity: 0; pointer-events: none; transition: 0.4s;
    }
    body.detail-open #backdrop { opacity: 1; pointer-events: auto; }

    #core-panel {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -40%) scale(0.9);
        width: 88%; max-width: 340px;
        background: var(--glass);
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        z-index: 50;
        opacity: 0; pointer-events: none;
        display: flex; flex-direction: column;
        transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        overflow: hidden;
    }
    
    #core-panel.active { 
        transform: translate(-50%, -50%) scale(1); 
        opacity: 1; pointer-events: auto; 
    }

    /* æ‰«æçº¿åŠ¨ç”» */
    #core-panel::after {
        content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
        background: linear-gradient(90deg, transparent, var(--accent), transparent);
        opacity: 0; animation: scan 3s ease-in-out infinite; pointer-events: none;
    }

    .panel-head {
        padding: 20px 20px 10px; text-align: center;
        border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    #core-title { font-size: 1.3rem; font-weight: bold; color: var(--accent); margin-bottom: 4px; word-break: break-all; }
    #core-meta { font-size: 0.75rem; color: #888; font-family: sans-serif; }

    /* æ–°å¢ Note æ˜¾ç¤º */
    .note-box {
        background: rgba(238, 185, 46, 0.08);
        border-left: 2px solid var(--accent);
        color: #ccc; font-size: 0.75rem; padding: 8px 12px;
        margin: 10px 15px 0; text-align: left;
        border-radius: 0 4px 4px 0; display: none;
    }

    #core-actions {
        padding: 15px 20px;
        display: flex; flex-direction: column; gap: 10px;
        max-height: 50vh; overflow-y: auto;
    }
    #core-actions::-webkit-scrollbar { width: 0; }

    /* è¾“å…¥æ¡† */
    .custom-input {
        background: rgba(0,0,0,0.3);
        border: 1px solid var(--border);
        border-bottom: 2px solid var(--accent);
        color: var(--accent);
        padding: 10px; border-radius: 4px 4px 0 0;
        font-family: inherit; text-align: center;
        width: 100%; box-sizing: border-box; outline: none;
        font-size: 14px; margin-bottom: 5px;
    }
    .custom-input:focus { background: rgba(238, 185, 46, 0.05); }

    /* æŒ‰é’® */
    .btn {
        position: relative;
        background: rgba(255,255,255,0.03);
        border: 1px solid var(--border);
        color: #ddd;
        padding: 12px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        display: flex; align-items: center; justify-content: center; gap: 8px;
        text-decoration: none; transition: 0.2s;
        -webkit-tap-highlight-color: transparent;
    }
    .btn:active { transform: scale(0.97); background: rgba(255,255,255,0.08); }
    
    .btn.primary { background: rgba(238, 185, 46, 0.1); border-color: rgba(238, 185, 46, 0.3); color: var(--accent); font-weight: bold; }
    .btn.dashed { border-style: dashed; opacity: 0.8; font-size: 12px; padding: 10px; }

    .close-tag {
        text-align: center; padding: 12px; color: #555; font-size: 12px;
        cursor: pointer; border-top: 1px solid rgba(255,255,255,0.05);
        transition: 0.2s;
    }
    .close-tag:active { color: var(--danger); }

    /* --- åŠ¨ç”» --- */
    @keyframes rotate-orbit { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
    @keyframes pulse { 0%, 100% { opacity: 0.4; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.3); } }
    @keyframes scan { 0% { top: 0; opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { top: 100%; opacity: 0; } }
    
    .anim-up { opacity: 0; transform: translateY(15px); animation: fadeUp 0.4s forwards; }
    @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

</style>
</head>
<body>

    <div id="header">
        <h1>{{TITLE}}</h1>
        <div class="subtitle">SYSTEM ONLINE</div>
    </div>

    <div id="universe">
        <div id="category-label">SYSTEM</div>
        
        <div id="absolute-center">
            <div id="ring" class="orbit-ring"></div>
            <div id="planets-container"></div>
        </div>
        
        <div id="backdrop" onclick="closeDetail()"></div>

        <div id="core-panel">
            <div class="panel-head anim-up" style="animation-delay: 0s">
                <div id="core-title">TITLE</div>
                <div id="core-meta">INFO</div>
            </div>
            
            <div id="note-display" class="note-box anim-up" style="animation-delay: 0.1s"></div>

            <div id="core-actions">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="close-tag anim-up" style="animation-delay: 0.3s" onclick="closeDetail()">
                TAP TO CLOSE
            </div>
        </div>
    </div>

    <div id="nav-dots"></div>

<script>
    // ================= åˆå§‹åŒ–æ•°æ® =================
    const RAW_DATA = '{{DATA}}';
    let data = { config: {}, customTabs: [], items: [] };

    // ä¿®å¤æ•°æ®è§£æé€»è¾‘ï¼šä¼˜å…ˆå¤„ç†ç©ºæ¨¡æ¿æƒ…å†µ
    if (RAW_DATA.indexOf('{{') === 0) {
        // Mock Data
        data = {
            config: { showMF: true, showLY: true },
            customTabs: ['VIP'],
            items: [
                { id: 1, tab: 'LX', name: 'æ ‡å‡†æº', note: 'ç¨³å®šæ¨è', file: { content: '#', size: 1024 } },
                { id: 2, tab: 'LX', name: 'Keyæºæµ‹è¯•', note: 'æµ‹è¯•ç‹¬ç«‹è¾“å…¥æ¡†', file: { content: '#', size: 2000 }, keyConfig: { enableUrl: true, url: 'http://a.com/', enableVar: true, var: 'KEY' } },
                ...Array.from({length: 8}, (_, i) => ({ id: 10+i, tab: 'VIP', name: `Node_${i}`, file: {content:'#'} }))
            ]
        };
    } else {
        try { 
            data = JSON.parse(RAW_DATA); 
            // ç¡®ä¿ config å¯¹è±¡å­˜åœ¨ï¼Œé˜²æ­¢ undefined æŠ¥é”™
            if (!data.config) data.config = {};
        } catch(e) { 
            console.error("Data Parse Error", e);
            alert("æ•°æ®è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥ JSON æ ¼å¼");
        }
    }

    const tabs = ['LX', ...(data.config?.showMF ? ['Music Free'] : []), ...(data.config?.showLY ? ['æ¾œéŸ³'] : []), ...(data.customTabs || [])];
    let currentTabIdx = 0;
    let isDetailOpen = false;

    // ================= æ ¸å¿ƒæ¸²æŸ“ =================
    
    function init() {
        renderDots();
        loadTab(0);
        setupGestures();
        window.addEventListener('resize', () => {
            if(!isDetailOpen) loadTab(currentTabIdx);
        });
    }

    function renderDots() {
        // æ¸²æŸ“å¸¦æœ‰æ–‡å­—æ ‡ç­¾çš„å¯¼èˆªç‚¹
        document.getElementById('nav-dots').innerHTML = tabs.map((t, i) => `
            <div class="nav-item ${i===0?'active':''}" onclick="switchTab(${i})">
                <span class="nav-text">${t}</span>
                <span class="nav-dot"></span>
            </div>
        `).join('');
    }

    function switchTab(idx) {
        if (isDetailOpen) closeDetail();
        if (idx < 0) idx = tabs.length - 1;
        if (idx >= tabs.length) idx = 0;
        currentTabIdx = idx;
        
        document.querySelectorAll('.nav-item').forEach((d, i) => d.classList.toggle('active', i === idx));
        loadTab(idx);
    }

    function loadTab(idx) {
        const tabName = tabs[idx];
        const items = data.items.filter(i => (i.tab || 'LX') === tabName);
        const container = document.getElementById('planets-container');
        const ring = document.getElementById('ring');
        const label = document.getElementById('category-label');
        
        label.style.opacity = 0;
        setTimeout(() => { 
            label.innerText = tabName; 
            label.style.opacity = items.length ? 0.05 : 0.02; 
        }, 300);

        container.innerHTML = '';

        if (items.length === 0) {
            ring.style.width = '0'; ring.style.height = '0';
            return;
        }

        const minSide = Math.min(window.innerWidth, window.innerHeight);
        const baseR = minSide * 0.35; 
        const finalR = Math.min(baseR + (items.length > 8 ? (items.length - 8) * 5 : 0), minSide * 0.42);
        
        ring.style.width = (finalR * 2) + 'px';
        ring.style.height = (finalR * 2) + 'px';

        const step = 360 / items.length;

        items.forEach((item, i) => {
            const angle = (i * step - 90) * (Math.PI / 180);
            const x = Math.cos(angle) * finalR;
            const y = Math.sin(angle) * finalR;

            const el = document.createElement('div');
            el.className = 'planet';
            el.innerHTML = `<div class="planet-core"></div><div class="planet-label">${item.name}</div>`;
            el.style.transform = `translate(0px, 0px) scale(0)`;
            el.onclick = (e) => { e.stopPropagation(); openDetail(item); };
            
            container.appendChild(el);

            setTimeout(() => {
                el.style.transform = `translate(${x}px, ${y}px) scale(1)`;
            }, 50 + i * 20);
        });
    }

    // ================= è¯¦æƒ…ä¸äº¤äº’ =================

    function openDetail(item) {
        if (isDetailOpen) return;
        isDetailOpen = true;
        document.body.classList.add('detail-open');

        document.getElementById('core-title').innerText = item.name;
        let meta = `ID:${item.id}`;
        if (item.file) meta += ` | ${(item.file.size/1024).toFixed(1)}KB`;
        document.getElementById('core-meta').innerText = meta;
        
        // Note æ˜¾ç¤º
        const noteEl = document.getElementById('note-display');
        if (item.note) {
            noteEl.style.display = 'block';
            noteEl.innerText = "NOTE: " + item.note;
        } else {
            noteEl.style.display = 'none';
        }

        const box = document.getElementById('core-actions');
        let html = '';
        let d = 0.1;

        const add = (cls, js, ico, txt) => {
            html += `<button class="btn ${cls} anim-up" style="animation-delay:${d}s" onclick="${js}">
                <span>${ico}</span><span>${txt}</span>
            </button>`;
            d += 0.05;
        };

        // 1. æœ¬åœ°å®‰è£…
        if (item.file) add('primary', `act(${item.id}, 'base64')`, 'ğŸ“¥', 'å®‰è£…åˆ°æœ¬åœ°');

        // 2. Key è¾“å…¥é€»è¾‘
        const hasUrlKey = item.keyConfig?.enableUrl;
        const hasVarKey = item.keyConfig?.enableVar && item.file;

        if (hasUrlKey || hasVarKey) {
            html += `<input type="text" id="plugin-key-input" class="custom-input anim-up" 
                      style="animation-delay:${d}s" placeholder="åœ¨æ­¤è¾“å…¥ Key / Token" autocomplete="off">`;
            d += 0.05;
            if (hasUrlKey) add('dashed', `act(${item.id}, 'url')`, 'ğŸ”‘', 'åœ¨çº¿å¯¼å…¥ Key');
            if (hasVarKey) add('dashed', `act(${item.id}, 'var')`, 'ğŸ› ï¸', 'å˜é‡æ›¿æ¢å®‰è£…');
        }

        // 3. é“¾æ¥
        if (item.dlLink) add('', `act(${item.id}, 'link')`, 'ğŸ”—', 'ç›´é“¾ä¸‹è½½');
        if (item.links) item.links.forEach(l => {
            add('dashed', `window.open('${l.url.replace(/'/g,"\\'")}', '_blank')`, 'ğŸŒ', l.text||'å¤–éƒ¨é“¾æ¥');
        });

        if (!html) html = `<div style="padding:20px;text-align:center;color:#666">ä»…å±•ç¤º</div>`;
        box.innerHTML = html;
        
        document.getElementById('core-panel').classList.add('active');
    }

    function closeDetail() {
        isDetailOpen = false;
        document.body.classList.remove('detail-open');
        document.getElementById('core-panel').classList.remove('active');
    }

    window.act = (id, type) => {
        const item = data.items.find(x => x.id == id);
        if(!item) return;

        // è·å–è¾“å…¥æ¡†çš„å€¼
        const inputEl = document.getElementById('plugin-key-input');
        const keyVal = inputEl ? inputEl.value.trim() : '';

        if (type === 'base64') dl(item.file.content, item.name);
        else if (type === 'link') window.open(item.dlLink, '_blank');
        else if (type === 'url' || type === 'var') {
            if (!keyVal) {
                if(inputEl) {
                    inputEl.style.borderColor = '#ff4757';
                    inputEl.placeholder = 'å¿…é¡»å¡«å†™ Key !';
                    setTimeout(() => inputEl.style.borderColor = '', 1000);
                }
                return;
            }

            if (type === 'url') {
                window.open(item.keyConfig.url + keyVal, '_blank');
            } else {
                try {
                    const raw = decodeURIComponent(escape(atob(item.file.content.split(',')[1] || item.file.content)));
                    const reg = new RegExp(`(const|var|let)\\s+${item.keyConfig.var}\\s*=\\s*['"][^'"]*['"]`);
                    if(!reg.test(raw)) return alert('è„šæœ¬ä¸­æœªæ‰¾åˆ°å¯¹åº”å˜é‡: ' + item.keyConfig.var);
                    const patch = raw.replace(reg, `$1 ${item.keyConfig.var}="${keyVal}"`);
                    const url = URL.createObjectURL(new Blob([patch], {type:'text/javascript'}));
                    dl(url, item.name);
                } catch(e) { alert('ç”Ÿæˆå¤±è´¥:' + e.message); }
            }
        } 
    };

    function dl(u, n) {
        const a = document.createElement('a'); a.href = u; a.download = n;
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }

    function setupGestures() {
        let sx = 0; let isD = false;
        document.addEventListener('touchstart', e => { if(!isDetailOpen){ isD=true; sx=e.touches[0].pageX; } }, {passive:true});
        document.addEventListener('touchend', e => {
            if(!isD) return; isD=false;
            const diff = e.changedTouches[0].pageX - sx;
            if(Math.abs(diff) > 50) switchTab(diff > 0 ? currentTabIdx-1 : currentTabIdx+1);
        });
        document.addEventListener('mousedown', e => { if(!isDetailOpen){ isD=true; sx=e.pageX; } });
        document.addEventListener('mouseup', e => {
            if(!isD) return; isD=false;
            if(Math.abs(e.pageX - sx) > 50) switchTab(e.pageX - sx > 0 ? currentTabIdx-1 : currentTabIdx+1);
        });
    }

    init();
</script>
</body>
</html>