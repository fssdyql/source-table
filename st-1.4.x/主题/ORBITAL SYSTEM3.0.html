<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>{{TITLE}}</title>
<style>
    /* --- æ ¸å¿ƒå˜é‡ --- */
    :root {
        --bg-deep: #0a0a0a;
        --accent: #eeb92e;       /* ç¥ç€é‡‘ */
        --accent-glow: rgba(238, 185, 46, 0.4);
        --glass: rgba(20, 20, 20, 0.92);
        --border: rgba(255, 255, 255, 0.15);
        --text: #f1f1f1;
    }

    body {
        margin: 0; background: var(--bg-deep);
        background-image: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
        height: 100vh; overflow: hidden;
        font-family: "Courier New", sans-serif; /* ç§»åŠ¨ç«¯sans-serifæ›´æ˜“è¯» */
        color: var(--text); user-select: none;
        -webkit-tap-highlight-color: transparent;
    }

    /* --- UI å…ƒç´  --- */
    #header { 
        position: absolute; top: max(20px, env(safe-area-inset-top)); left: 20px; 
        z-index: 10; pointer-events: none; 
    }
    h1 { margin: 0; font-size: 1.2rem; letter-spacing: 2px; color: var(--accent); }
    .subtitle { font-size: 0.7rem; opacity: 0.5; margin-top: 4px; }

    #nav-dots { 
        position: absolute; bottom: max(30px, env(safe-area-inset-bottom)); 
        width: 100%; text-align: center; z-index: 10; 
    }
    .nav-dot { 
        display: inline-block; width: 8px; height: 8px; 
        background: rgba(255,255,255,0.2); border-radius: 50%; 
        margin: 0 8px; transition: 0.3s; cursor: pointer; position: relative;
    }
    .nav-dot::after { content: ''; position: absolute; inset: -10px; }
    .nav-dot.active { 
        background: var(--accent); transform: scale(1.3); 
        box-shadow: 0 0 10px var(--accent-glow); 
    }

    /* --- å®‡å®™è§†å£ --- */
    #universe {
        position: relative; width: 100vw; height: 100vh;
        overflow: hidden; perspective: 1000px;
    }

    #category-label {
        position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        font-size: 14vw; font-weight: 900;
        color: rgba(255,255,255,0.02); pointer-events: none;
        white-space: nowrap; letter-spacing: -2px;
        transition: opacity 0.5s;
    }

    /* --- ç»å¯¹å®šä½ä¸­å¿ƒ (ä¿®æ­£åç§») --- */
    #absolute-center {
        position: absolute; top: 50%; left: 50%;
        width: 0; height: 0; z-index: 1;
        transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s;
    }
    body.detail-open #absolute-center {
        transform: scale(0.8); opacity: 0.2; filter: blur(4px);
    }

    .orbit-ring {
        position: absolute; top: 0; left: 0;
        border: 1px dashed rgba(238, 185, 46, 0.15);
        border-radius: 50%;
        transform: translate(-50%, -50%); 
        animation: rotate-orbit 120s linear infinite;
        pointer-events: none;
        transition: width 0.5s, height 0.5s;
    }

    /* --- æ˜Ÿçƒæœ¬ä½“ --- */
    .planet {
        position: absolute; top: 0; left: 0;
        width: 40px; height: 40px; 
        margin-left: -20px; margin-top: -20px;
        display: flex; justify-content: center; align-items: center;
        cursor: pointer; z-index: 5;
        transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }
    
    .planet-core {
        width: 14px; height: 14px;
        background: var(--accent); border-radius: 50%;
        box-shadow: 0 0 15px var(--accent-glow);
        transition: 0.3s; position: relative; z-index: 2;
    }
    .planet:active .planet-core { transform: scale(1.3); background: #fff; }

    /* --- å«æ˜Ÿå¼æ–‡å­—å¼•å¯¼ç³»ç»Ÿ (å…³é”®ä¿®æ”¹) --- */
    .planet-guide {
        position: absolute; top: 50%; left: 50%;
        width: 0; height: 0;
        pointer-events: none;
        /* æ—‹è½¬æ•´ä¸ªå¼•å¯¼è‡‚ï¼Œä½¿å…¶æŒ‡å‘åœ†å¿ƒå¤–ä¾§ */
        transform: rotate(var(--angle)); 
        z-index: 1;
    }

    /* é»„è‰²è¿æ¥çº¿ */
    .guide-line {
        position: absolute; top: 0; left: 0;
        height: 1px; background: var(--accent);
        width: 0; /* åˆå§‹å®½åº¦ä¸º0 */
        transform-origin: left center;
        opacity: 0.6;
        transition: width 0.4s ease-out 0.2s; /* å»¶æ—¶å±•å¼€ */
    }
    
    /* æœ€ç»ˆæ–‡å­—å®¹å™¨ */
    .guide-text-wrapper {
        position: absolute; top: -10px; 
        /* left ç”± JS æ ¹æ®è¿çº¿é•¿åº¦åŠ¨æ€è®¾å®š */
        left: var(--arm-len); 
        height: 20px; display: flex; align-items: center;
        /* å…³é”®ï¼šåå‘æ—‹è½¬æ–‡å­—ï¼Œä¿è¯æ–‡å­—æ°¸è¿œæ°´å¹³ */
        transform: rotate(calc(var(--angle) * -1));
        transform-origin: center center;
        opacity: 0; 
        transition: opacity 0.3s ease-out 0.4s;
    }

    /* æ–‡å­—æœ¬ä½“ */
    .planet-text {
        font-size: 12px; font-weight: bold; color: #fff;
        background: rgba(0,0,0,0.6); padding: 2px 6px;
        border-radius: 4px; white-space: nowrap;
        border: 1px solid rgba(238, 185, 46, 0.3);
        box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }

    /* æ¿€æ´»æ€ï¼šå±•å¼€è¿çº¿å’Œæ–‡å­— */
    .planet.deployed .guide-line { width: var(--arm-len); }
    .planet.deployed .guide-text-wrapper { opacity: 1; }


    /* --- è¯¦æƒ…é¢æ¿ --- */
    #backdrop {
        position: absolute; inset: 0; z-index: 40;
        background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
        opacity: 0; pointer-events: none; transition: 0.4s;
    }
    body.detail-open #backdrop { opacity: 1; pointer-events: auto; }

    #core-panel {
        position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -45%) scale(0.9);
        width: 85%; max-width: 320px;
        background: var(--glass);
        border: 1px solid var(--border);
        border-radius: 16px;
        box-shadow: 0 25px 50px rgba(0,0,0,0.8);
        z-index: 50; opacity: 0; pointer-events: none;
        display: flex; flex-direction: column;
        transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        overflow: hidden;
    }
    #core-panel.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: auto; }
    
    /* é¡¶éƒ¨è£…é¥°æ¡ */
    #core-panel::before {
        content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px;
        background: var(--accent); box-shadow: 0 0 10px var(--accent);
    }

    .panel-head { padding: 25px 20px 10px; text-align: center; }
    #core-title { font-size: 1.4rem; font-weight: bold; color: var(--accent); margin-bottom: 5px; }
    #core-meta { font-size: 0.75rem; color: #999; }

    #core-actions { padding: 15px 20px 20px; display: flex; flex-direction: column; gap: 10px; max-height: 50vh; overflow-y: auto; }

    .btn {
        background: rgba(255,255,255,0.05); border: 1px solid var(--border);
        color: #ddd; padding: 12px; border-radius: 8px; font-size: 13px;
        cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
        transition: 0.2s;
    }
    .btn:active { transform: scale(0.96); background: rgba(255,255,255,0.1); }
    .btn.primary { background: rgba(238, 185, 46, 0.15); border-color: var(--accent); color: var(--accent); font-weight: bold; }
    
    .close-tag { text-align: center; padding: 15px; color: #666; font-size: 11px; cursor: pointer; border-top: 1px solid rgba(255,255,255,0.05); }

    @keyframes rotate-orbit { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
    .anim-up { opacity: 0; transform: translateY(10px); animation: fadeUp 0.3s forwards; }
    @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

</style>
</head>
<body>

    <div id="header">
        <h1>{{TITLE}}</h1>
        <div class="subtitle">SYSTEM ONLINE</div>
    </div>

    <div id="universe">
        <div id="category-label">SYSTEM</div>
        
        <div id="absolute-center">
            <div id="ring" class="orbit-ring"></div>
            <div id="planets-container"></div>
        </div>
        
        <div id="backdrop" onclick="closeDetail()"></div>

        <div id="core-panel">
            <div class="panel-head anim-up">
                <div id="core-title">TITLE</div>
                <div id="core-meta">INFO</div>
            </div>
            <div id="core-actions"></div>
            <div class="close-tag anim-up" onclick="closeDetail()">TAP OUTSIDE TO CLOSE</div>
        </div>
    </div>

    <div id="nav-dots"></div>

<script>
    const RAW_DATA = '{{DATA}}';
    let data = { config: {}, customTabs: [], items: [] };

    try {
        if (RAW_DATA.trim().startsWith('{')) data = JSON.parse(RAW_DATA);
        else throw new Error("Mock");
    } catch(e) {
        data = {
            config: { showMF: true, showLY: true },
            customTabs: ['VIP'],
            items: [
                { id: 1, tab: 'LX', name: 'å®˜æ–¹æº', file: { content: '#' } },
                { id: 2, tab: 'LX', name: 'æç®€é£æ ¼', dlLink: 'https://github.com' },
                { id: 3, tab: 'LX', name: 'é«˜éŸ³è´¨æ’ä»¶', file: { content: '#' }, keyConfig: { enableUrl: true, url: '' } },
                { id: 4, tab: 'LX', name: 'èšåˆæœç´¢', file: { content: '#' } },
                { id: 5, tab: 'LX', name: 'ç½‘æ˜“äº‘æ¨¡å—', file: { content: '#' } },
                ...Array.from({length: 8}, (_, i) => ({ id: 10+i, tab: 'VIP', name: `æµ‹è¯•æ¨¡å—_${i}`, file: {content:'#'} }))
            ]
        };
    }

    const tabs = ['LX', ...(data.config?.showMF ? ['Music Free'] : []), ...(data.config?.showLY ? ['æ¾œéŸ³'] : []), ...(data.customTabs || [])];
    let currentTabIdx = 0;
    let isDetailOpen = false;

    function init() {
        renderDots();
        loadTab(0);
        setupGestures();
        window.addEventListener('resize', () => loadTab(currentTabIdx));
    }

    function renderDots() {
        document.getElementById('nav-dots').innerHTML = tabs.map((_, i) => 
            `<span class="nav-dot ${i===0?'active':''}" onclick="switchTab(${i})"></span>`
        ).join('');
    }

    function switchTab(idx) {
        if (isDetailOpen) closeDetail();
        if (idx < 0) idx = tabs.length - 1;
        if (idx >= tabs.length) idx = 0;
        currentTabIdx = idx;
        document.querySelectorAll('.nav-dot').forEach((d, i) => d.classList.toggle('active', i === idx));
        loadTab(idx);
    }

    function loadTab(idx) {
        const tabName = tabs[idx];
        const items = data.items.filter(i => (i.tab || 'LX') === tabName);
        const container = document.getElementById('planets-container');
        const ring = document.getElementById('ring');
        const label = document.getElementById('category-label');
        
        label.style.opacity = 0;
        setTimeout(() => { label.innerText = tabName; label.style.opacity = items.length ? 0.05 : 0.02; }, 300);

        container.innerHTML = '';

        // --- åŠå¾„è®¡ç®— ---
        const minSide = Math.min(window.innerWidth, window.innerHeight);
        // ç¨å¾®ç¼©å°è½¨é“åŠå¾„ï¼Œç»™å¤–éƒ¨çš„æ–‡å­—å’Œè¿çº¿ç•™å‡ºç©ºé—´
        const baseR = minSide * 0.28; 
        const finalR = Math.min(baseR + (items.length > 6 ? (items.length - 6) * 4 : 0), minSide * 0.35);
        
        ring.style.width = (finalR * 2) + 'px';
        ring.style.height = (finalR * 2) + 'px';

        if (items.length === 0) return;

        const step = 360 / items.length;

        items.forEach((item, i) => {
            const angleDeg = (i * step - 90);
            const angleRad = angleDeg * (Math.PI / 180);
            const x = Math.cos(angleRad) * finalR;
            const y = Math.sin(angleRad) * finalR;

            // --- èºæ—‹/é”™ä½é€»è¾‘ ---
            // å¥‡æ•°é¡¹å¼•çº¿é•¿ï¼Œå¶æ•°é¡¹å¼•çº¿çŸ­ã€‚ä¸”é¡¹ç›®è¶Šå¤šï¼Œå·®å¼‚è¶Šæ˜æ˜¾ï¼Œé˜²æ­¢æ–‡å­—é‡å 
            const isOdd = i % 2 !== 0;
            const armLength = isOdd ? 65 : 35; 

            const el = document.createElement('div');
            el.className = 'planet';
            el.style.setProperty('--angle', `${angleDeg}deg`); // ä¼ å…¥è§’åº¦ä¾›CSSæ—‹è½¬ä½¿ç”¨
            el.style.setProperty('--arm-len', `${armLength}px`); // ä¼ å…¥è‡‚é•¿
            
            // HTMLç»“æ„ï¼šæ ¸å¿ƒ + å¼•å¯¼ç³»ç»Ÿ(æ—‹è½¬è‡‚ -> çº¿ -> æ–‡å­—)
            el.innerHTML = `
                <div class="planet-core"></div>
                <div class="planet-guide">
                    <div class="guide-line"></div>
                    <div class="guide-text-wrapper">
                        <span class="planet-text">${item.name}</span>
                    </div>
                </div>
            `;
            
            el.style.transform = `translate(0px, 0px) scale(0)`;
            el.onclick = (e) => { e.stopPropagation(); openDetail(item); };
            
            container.appendChild(el);

            // åŠ¨ç”»åºåˆ—
            setTimeout(() => {
                // 1. æ˜Ÿçƒé£å…¥
                el.style.transform = `translate(${x}px, ${y}px) scale(1)`;
                // 2. å±•å¼€è¿çº¿å’Œæ–‡å­— (é€šè¿‡ class æ§åˆ¶ CSS transition)
                setTimeout(() => el.classList.add('deployed'), 300);
            }, 50 + i * 20);
        });
    }

    // ================= è¯¦æƒ…é¢æ¿ =================
    function openDetail(item) {
        if (isDetailOpen) return;
        isDetailOpen = true;
        document.body.classList.add('detail-open');

        document.getElementById('core-title').innerText = item.name;
        let meta = `ID:${item.id}`;
        if (item.file) meta += ` | ${(item.file.size/1024).toFixed(1)}KB`;
        document.getElementById('core-meta').innerText = meta;
        
        const box = document.getElementById('core-actions');
        let html = '';
        let d = 0;

        const add = (cls, js, ico, txt) => {
            d += 0.05;
            html += `<button class="btn ${cls} anim-up" style="animation-delay:${d}s" onclick="${js}">
                <span>${ico}</span><span>${txt}</span>
            </button>`;
        };

        if (item.file) add('primary', `act(${item.id}, 'base64')`, 'ğŸ“¥', 'å®‰è£…æ–‡ä»¶');
        if (item.dlLink) add('', `act(${item.id}, 'link')`, 'ğŸ”—', 'ç›´é“¾ä¸‹è½½');
        if (item.links) item.links.forEach(l => add('', `window.open('${l.url.replace(/'/g,"\\'")}')`, 'ğŸŒ', l.text||'é“¾æ¥'));
        if (item.keyConfig?.enableUrl) add('', `act(${item.id}, 'url')`, 'ğŸ”‘', 'Keyå¯¼å…¥');
        if (item.keyConfig?.enableVar && item.file) add('', `act(${item.id}, 'var')`, 'ğŸ› ï¸', 'å˜é‡æ›¿æ¢');

        box.innerHTML = html || '<div style="padding:20px;text-align:center;color:#666">ä»…å±•ç¤º</div>';
        document.getElementById('core-panel').classList.add('active');
    }

    function closeDetail() {
        isDetailOpen = false;
        document.body.classList.remove('detail-open');
        document.getElementById('core-panel').classList.remove('active');
    }

    window.act = (id, type) => {
        const item = data.items.find(x => x.id == id);
        if(!item) return;

        if (type === 'base64') dl(item.file.content, item.name);
        else if (type === 'link') window.open(item.dlLink, '_blank');
        else if (type === 'url') {
            const k = prompt('è¯·è¾“å…¥ Key:'); if(k) window.open(item.keyConfig.url + k, '_blank');
        } 
        else if (type === 'var') {
            const k = prompt(`æ›¿æ¢ ${item.keyConfig.var}:`);
            if(k) {
                try {
                    const raw = decodeURIComponent(escape(atob(item.file.content.split(',')[1] || item.file.content)));
                    const reg = new RegExp(`(const|var|let)\\s+${item.keyConfig.var}\\s*=\\s*['"][^'"]*['"]`);
                    if(!reg.test(raw)) return alert('å˜é‡æœªæ‰¾åˆ°');
                    const patch = raw.replace(reg, `$1 ${item.keyConfig.var}="${k}"`);
                    const url = URL.createObjectURL(new Blob([patch], {type:'text/javascript'}));
                    dl(url, item.name);
                } catch(e) { alert('é”™è¯¯:' + e.message); }
            }
        }
    };

    function dl(u, n) {
        const a = document.createElement('a'); a.href = u; a.download = n;
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }

    function setupGestures() {
        let sx = 0, isD = false;
        document.addEventListener('touchstart', e => { if(!isDetailOpen){ isD=true; sx=e.touches[0].pageX; } }, {passive:true});
        document.addEventListener('touchend', e => {
            if(!isD) return; isD=false;
            if(Math.abs(e.changedTouches[0].pageX - sx) > 50) switchTab(e.changedTouches[0].pageX - sx > 0 ? currentTabIdx-1 : currentTabIdx+1);
        });
        document.addEventListener('mousedown', e => { if(!isDetailOpen){ isD=true; sx=e.pageX; } });
        document.addEventListener('mouseup', e => {
            if(!isD) return; isD=false;
            if(Math.abs(e.pageX - sx) > 50) switchTab(e.pageX - sx > 0 ? currentTabIdx-1 : currentTabIdx+1);
        });
    }

    init();
</script>
</body>
</html>